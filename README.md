# Distributed Systems Go Demos

[![Go Version](https://img.shields.io/badge/Go-1.21+-blue.svg)](https://golang.org)
[![License](https://img.shields.io/badge/License-MIT-green.svg)](LICENSE)

> **æ•™è‚²æ€§ Go é¡¹ç›®**ï¼šé€šè¿‡å››ä¸ªç‹¬ç«‹çš„ã€å¯è¿è¡Œçš„ç¤ºä¾‹ï¼Œç³»ç»Ÿæ€§è§£é‡Šåˆ†å¸ƒå¼ç³»ç»Ÿçš„æ ¸å¿ƒé—®é¢˜

---

## ðŸ“š é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®æ—¨åœ¨é€šè¿‡å®žè·µä»£ç æ¼”ç¤ºåˆ†å¸ƒå¼ç³»ç»Ÿçš„å››ä¸ªæ ¸å¿ƒé—®é¢˜ï¼š

1. **ä¸ºä»€ä¹ˆä¼ ç»Ÿ Socket é€šä¿¡ä¸é€‚åˆæž„å»ºå¤æ‚åˆ†å¸ƒå¼ç³»ç»Ÿï¼Ÿ**
2. **å…¸åž‹ RPC ä¸­é—´ä»¶çš„å®Œæ•´å·¥ä½œæµç¨‹**ï¼ˆStub â†’ ç½‘ç»œ â†’ Skeleton â†’ æœ¬åœ°æ–¹æ³•ï¼‰
3. **ä¸åŒ RPC æ¡†æž¶ä¼ è¾“åè®®çš„å…±æ€§ä¸Žå·®å¼‚**
4. **å¦‚ä½•å®žçŽ°ä¸€ä¸ªæ¶ˆæ¯ä¸­é—´ä»¶**ï¼ˆPub/Sub æ¨¡å¼ vs ä¼ ç»Ÿæ¶ˆæ¯é˜Ÿåˆ—ï¼‰

æ¯ä¸ªç¤ºä¾‹éƒ½æ˜¯**å¯è¿è¡Œã€å¯éªŒè¯ã€æ”¯æŒå¹¶å‘**çš„å®Œæ•´å®žçŽ°ï¼Œä¸¥æ ¼éµå¾ª Go æ ‡å‡†å·¥ç¨‹å®žè·µã€‚

---

## ðŸŽ¯ æ ¸å¿ƒé—®é¢˜ä¸Žç­”æ¡ˆ

### é—®é¢˜ 1ï¼šä¸ºä»€ä¹ˆ Socket ä¸é€‚åˆæž„å»ºåˆ†å¸ƒå¼ç³»ç»Ÿï¼Ÿ

**ç¤ºä¾‹**: [01_raw_socket](./cmd/01_raw_socket) | **æ–‡æ¡£**: [docs/01_raw_socket.md](./docs/01_raw_socket.md)

**ç­”æ¡ˆè¦ç‚¹**:

åŽŸç”Ÿ Socket åªæ˜¯**é€šä¿¡åŽŸè¯­**ï¼Œç¼ºå°‘æž„å»ºåˆ†å¸ƒå¼ç³»ç»Ÿæ‰€éœ€çš„å…³é”®ç‰¹æ€§ï¼š

| ç—›ç‚¹ | è¯´æ˜Ž |
|------|------|
| âœ— æ‰‹åŠ¨åè®®è®¾è®¡ | éœ€è¦è‡ªå·±å®šä¹‰è¯·æ±‚/å“åº”æ ¼å¼ã€å¤„ç†ç²˜åŒ…æ‹†åŒ… |
| âœ— ç¼ºä¹ç±»åž‹å®‰å…¨ | æ–¹æ³•åã€å‚æ•°ç±»åž‹éƒ½æ˜¯å­—ç¬¦ä¸²ï¼Œæ— ç¼–è¯‘æ—¶æ£€æŸ¥ |
| âœ— é”™è¯¯å¤„ç†å¤æ‚ | ç½‘ç»œé”™è¯¯ã€åºåˆ—åŒ–é”™è¯¯ã€ä¸šåŠ¡é”™è¯¯æ··åœ¨ä¸€èµ· |
| âœ— æ— æœåŠ¡å‘çŽ° | å¿…é¡»ç¡¬ç¼–ç æœåŠ¡å™¨åœ°å€ |
| âœ— æ— è´Ÿè½½å‡è¡¡ | æ— æ³•è‡ªåŠ¨åˆ†å‘è¯·æ±‚åˆ°å¤šä¸ªæœåŠ¡å™¨ |
| âœ— æ— è¶…æ—¶æŽ§åˆ¶ | éœ€è¦æ‰‹åŠ¨å®žçŽ° |
| âœ— æ— ç†”æ–­é™çº§ | æœåŠ¡ä¸å¯ç”¨æ—¶æ²¡æœ‰ä¿æŠ¤æœºåˆ¶ |

**ç»“è®º**: Socket é€‚åˆå­¦ä¹ ç½‘ç»œç¼–ç¨‹åŸºç¡€ï¼Œä½†ä¸é€‚åˆç›´æŽ¥æž„å»ºåˆ†å¸ƒå¼ç³»ç»Ÿã€‚åº”ä½¿ç”¨ RPC æ¡†æž¶æˆ–æ¶ˆæ¯ä¸­é—´ä»¶ã€‚

---

### é—®é¢˜ 2ï¼šRPC ä¸­é—´ä»¶å¦‚ä½•å·¥ä½œï¼Ÿ

**ç¤ºä¾‹**: [02_simple_rpc](./cmd/02_simple_rpc) | **æ–‡æ¡£**: [docs/02_simple_rpc.md](./docs/02_simple_rpc.md)

**ç­”æ¡ˆè¦ç‚¹**:

RPC çš„æ ¸å¿ƒæ˜¯**éšè—ç½‘ç»œé€šä¿¡ç»†èŠ‚**ï¼Œè®©è¿œç¨‹è°ƒç”¨çœ‹èµ·æ¥åƒæœ¬åœ°è°ƒç”¨ã€‚

#### å®Œæ•´æµç¨‹ï¼š

```
Client Side                    Network                Server Side
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Client    â”‚                                      â”‚   Server    â”‚
â”‚             â”‚                                      â”‚             â”‚
â”‚  calc.Add() â”‚                                      â”‚             â”‚
â”‚      â†“      â”‚                                      â”‚             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                                      â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Stub  â”‚ â”‚  â”€â”€â”€â”€ JSON Request over TCP â”€â”€â”€â”€â–¶   â”‚  â”‚Skeletonâ”‚ â”‚
â”‚  â”‚(Client)â”‚ â”‚                                      â”‚  â”‚(Server)â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                                      â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚      â†“      â”‚                                      â”‚      â†“      â”‚
â”‚  Serialize  â”‚                                      â”‚  Deserializeâ”‚
â”‚      â†“      â”‚                                      â”‚      â†“      â”‚
â”‚   Send TCP  â”‚                                      â”‚   Reflect   â”‚
â”‚      â†“      â”‚                                      â”‚      â†“      â”‚
â”‚  Wait Resp  â”‚                                      â”‚  Call Local â”‚
â”‚      â†“      â”‚                                      â”‚    Method   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â—€â”€â”€â”€â”€ JSON Response over TCP â”€â”€â”€â”€  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚Deserialâ”‚ â”‚                                      â”‚  â”‚Serializeâ”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                                      â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚      â†“      â”‚                                      â”‚             â”‚
â”‚   return    â”‚                                      â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### å…³é”®æŠ€æœ¯ï¼š

- **æŽ¥å£å®šä¹‰**ï¼šæœåŠ¡å¥‘çº¦ï¼ˆ`type CalculatorService interface { Add(a, b int) int }`ï¼‰
- **å®¢æˆ·ç«¯ Stub**ï¼šè‡ªåŠ¨åºåˆ—åŒ–è¯·æ±‚ã€å‘é€ã€ç­‰å¾…å“åº”
- **æœåŠ¡ç«¯ Skeleton**ï¼šä½¿ç”¨ `reflect.Value.MethodByName()` åŠ¨æ€è°ƒç”¨æ–¹æ³•
- **å¹¶å‘æ”¯æŒ**ï¼šé€šè¿‡è¯·æ±‚ ID + channel å®žçŽ°è¯·æ±‚-å“åº”åŒ¹é…

---

### é—®é¢˜ 3ï¼šä¸åŒ RPC æ¡†æž¶çš„åè®®å·®å¼‚ï¼Ÿ

**ç¤ºä¾‹**: [04_real_world_examples/grpc_example](./cmd/04_real_world_examples/grpc_example) | **æ–‡æ¡£**: [docs/04_real_world_examples.md](./docs/04_real_world_examples.md)

**ç­”æ¡ˆè¦ç‚¹**:

| ç‰¹æ€§ | Simple RPC | gRPC |
|------|------------|------|
| **åè®®** | TCP + JSON | HTTP/2 + Protobuf |
| **æ€§èƒ½** | ä¸­ç­‰ | æžé«˜ï¼ˆProtobuf æ¯” JSON å¿« 5 å€ï¼Œå° 70%ï¼‰ |
| **ç±»åž‹å®‰å…¨** | è¿è¡Œæ—¶ | ç¼–è¯‘æ—¶ï¼ˆ.proto ç”Ÿæˆå¼ºç±»åž‹ä»£ç ï¼‰ |
| **å¤šè·¯å¤ç”¨** | æ—  | HTTP/2 åŽŸç”Ÿæ”¯æŒ |
| **æµå¼ä¼ è¾“** | ä¸æ”¯æŒ | æ”¯æŒï¼ˆå•å‘æµã€åŒå‘æµï¼‰ |
| **å¤šè¯­è¨€** | æ‰‹åŠ¨å®žçŽ° | è‡ªåŠ¨ç”Ÿæˆï¼ˆ50+ è¯­è¨€ï¼‰ |

#### å…±æ€§ï¼š

- âœ“ éƒ½éšè—ç½‘ç»œç»†èŠ‚
- âœ“ éƒ½ä½¿ç”¨æŽ¥å£å®šä¹‰å¥‘çº¦
- âœ“ éƒ½æ”¯æŒå¹¶å‘è¯·æ±‚

#### å·®å¼‚æ ¸å¿ƒï¼š

- **åè®®æ•ˆçŽ‡**ï¼šProtobufï¼ˆäºŒè¿›åˆ¶ï¼‰ vs JSONï¼ˆæ–‡æœ¬ï¼‰
- **ä¼ è¾“å±‚**ï¼šHTTP/2ï¼ˆå¤šè·¯å¤ç”¨ã€æµæŽ§ï¼‰ vs TCPï¼ˆåŸºç¡€è¿žæŽ¥ï¼‰
- **ç”Ÿæ€æˆç†Ÿåº¦**ï¼šgRPC æ˜¯å·¥ä¸šæ ‡å‡†ï¼ŒSimple RPC æ˜¯æ•™å­¦å®žçŽ°

---

### é—®é¢˜ 4ï¼šå¦‚ä½•å®žçŽ°æ¶ˆæ¯ä¸­é—´ä»¶ï¼Ÿ

**ç¤ºä¾‹**: [03_message_broker](./cmd/03_message_broker) | **æ–‡æ¡£**: [docs/03_message_broker.md](./docs/03_message_broker.md)

**ç­”æ¡ˆè¦ç‚¹**:

#### æ ¸å¿ƒå®žçŽ°ï¼ˆä½¿ç”¨ Go Channelï¼‰ï¼š

```go
type Broker struct {
    subscribers map[string][]chan Message  // Topic -> []Channel
}

// è®¢é˜…ï¼šåˆ›å»º channel
func (b *Broker) Subscribe(topic string) (<-chan Message, error) {
    ch := make(chan Message, 100)
    b.subscribers[topic] = append(b.subscribers[topic], ch)
    return ch, nil
}

// å‘å¸ƒï¼šéžé˜»å¡žå‘é€ï¼ˆä½¿ç”¨ select + defaultï¼‰
func (b *Broker) Publish(topic string, payload interface{}) error {
    for _, ch := range b.subscribers[topic] {
        select {
        case ch <- msg:  // å‘é€æˆåŠŸ
        default:         // Channel æ»¡ï¼Œä¸é˜»å¡ž
        }
    }
    return nil
}
```

#### Pub/Sub vs Queue æœ¬è´¨åŒºåˆ«ï¼š

| ç‰¹æ€§ | Pub/Sub (Broker) | Queue (Redis LPUSH/RPOP) |
|------|------------------|--------------------------|
| **æ¶ˆæ¯åˆ†å‘** | æ‰€æœ‰è®¢é˜…è€…éƒ½æ”¶åˆ°ï¼ˆ**å¹¿æ’­**ï¼‰ | åªæœ‰ä¸€ä¸ªæ¶ˆè´¹è€…æ”¶åˆ°ï¼ˆ**ç«žäº‰**ï¼‰ |
| **é€‚ç”¨åœºæ™¯** | äº‹ä»¶é€šçŸ¥ã€æ—¥å¿—æ”¶é›† | ä»»åŠ¡é˜Ÿåˆ—ã€è´Ÿè½½å‡è¡¡ |
| **æ¶ˆè´¹è€…å…³ç³»** | ç‹¬ç«‹å¹¶è¡Œ | ç«žäº‰æ¶ˆè´¹ |

#### ä¸ºä»€ä¹ˆä¸éœ€è¦è½®è¯¢ï¼Ÿ

- âœ— **é”™è¯¯æ–¹å¼**ï¼ˆè½®è¯¢ï¼‰ï¼š`for { if hasMessage() { ... } sleep(100ms) }` â†’ æµªè´¹ CPU
- âœ“ **æ­£ç¡®æ–¹å¼**ï¼ˆChannelï¼‰ï¼š`for msg := range msgChan { ... }` â†’ é˜»å¡žç­‰å¾…ï¼Œé›¶ CPU æ¶ˆè€—

#### ä¸Ž NATS çš„å¯¹æ¯”ï¼š

| ç‰¹æ€§ | Broker (æœ¬ç¤ºä¾‹) | NATS |
|------|----------------|------|
| **éƒ¨ç½²** | å†…å­˜ï¼ˆå•è¿›ç¨‹ï¼‰ | ç‹¬ç«‹æœåŠ¡å™¨ |
| **æ€§èƒ½** | æžé«˜ï¼ˆå†…å­˜ï¼‰ | ç™¾ä¸‡çº§ msg/s |
| **æŒä¹…åŒ–** | æ—  | JetStream æ”¯æŒ |
| **é›†ç¾¤** | æ—  | åŽŸç”Ÿé›†ç¾¤ã€é«˜å¯ç”¨ |
| **é€‚ç”¨** | æ•™å­¦ã€å•è¿›ç¨‹ | ç”Ÿäº§çŽ¯å¢ƒã€åˆ†å¸ƒå¼ç³»ç»Ÿ |

---

## ðŸ—ï¸ é¡¹ç›®ç»“æž„

```
distributed-systems-go-demos/
â”œâ”€â”€ go.mod                              # Go æ¨¡å—å®šä¹‰
â”œâ”€â”€ README.md                           # ä¸»æŠ¥å‘Šï¼ˆæœ¬æ–‡ä»¶ï¼‰
â”œâ”€â”€ cmd/                                # å¯æ‰§è¡Œç¤ºä¾‹
â”‚   â”œâ”€â”€ 01_raw_socket/                  # é—®é¢˜ 1ï¼šåŽŸç”Ÿ Socket ç¤ºä¾‹
â”‚   â”‚   â”œâ”€â”€ server/main.go             # TCP æœåŠ¡å™¨ï¼ˆ:9001ï¼‰
â”‚   â”‚   â””â”€â”€ client/main.go             # TCP å®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ 02_simple_rpc/                  # é—®é¢˜ 2ï¼šè‡ªå®žçŽ° RPC
â”‚   â”‚   â”œâ”€â”€ server/main.go             # RPC æœåŠ¡å™¨ï¼ˆ:9100ï¼‰
â”‚   â”‚   â””â”€â”€ client/main.go             # RPC å®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ 03_message_broker/              # é—®é¢˜ 4ï¼šè‡ªå®žçŽ° Broker
â”‚   â”‚   â”œâ”€â”€ broker/main.go             # Broker æœåŠ¡å™¨ï¼ˆ:9200ï¼‰
â”‚   â”‚   â”œâ”€â”€ producer/main.go           # æ¶ˆæ¯ç”Ÿäº§è€…
â”‚   â”‚   â””â”€â”€ consumer/main.go           # æ¶ˆæ¯æ¶ˆè´¹è€…
â”‚   â””â”€â”€ 04_real_world_examples/         # é—®é¢˜ 3ï¼šå·¥ä¸šçº§å¯¹æ¯”
â”‚       â”œâ”€â”€ grpc_example/              # gRPC ç¤ºä¾‹
â”‚       â”‚   â”œâ”€â”€ server/main.go         # gRPC æœåŠ¡å™¨ï¼ˆ:50051ï¼‰
â”‚       â”‚   â””â”€â”€ client/main.go         # gRPC å®¢æˆ·ç«¯
â”‚       â””â”€â”€ nats_example/              # NATS ç¤ºä¾‹
â”‚           â”œâ”€â”€ publisher/main.go      # NATS å‘å¸ƒè€…
â”‚           â””â”€â”€ subscriber/main.go     # NATS è®¢é˜…è€…
â”œâ”€â”€ internal/                           # å†…éƒ¨å®žçŽ°ï¼ˆä¸å¯¹å¤–æš´éœ²ï¼‰
â”‚   â”œâ”€â”€ rpc/                           # RPC æ¡†æž¶å®žçŽ°
â”‚   â”‚   â”œâ”€â”€ client.go                  # Stubï¼ˆå®¢æˆ·ç«¯ä»£ç†ï¼‰
â”‚   â”‚   â”œâ”€â”€ server.go                  # Skeletonï¼ˆæœåŠ¡ç«¯åˆ†å‘ï¼‰
â”‚   â”‚   â””â”€â”€ codec.go                   # JSON ç¼–è§£ç 
â”‚   â””â”€â”€ broker/                        # Broker å®žçŽ°
â”‚       â””â”€â”€ broker.go                  # Pub/Sub æ ¸å¿ƒé€»è¾‘
â”œâ”€â”€ pkg/                                # å…¬å…±åº“
â”‚   â””â”€â”€ socket/                        # Socket å·¥å…·å‡½æ•°
â”‚       â””â”€â”€ util.go                    # JSON è¯»å†™å°è£…
â”œâ”€â”€ api/proto/                          # gRPC åè®®å®šä¹‰
â”‚   â”œâ”€â”€ calculator.proto               # Protobuf å®šä¹‰
â”‚   â”œâ”€â”€ calculator.pb.go               # ç”Ÿæˆçš„æ¶ˆæ¯ä»£ç 
â”‚   â””â”€â”€ calculator_grpc.pb.go          # ç”Ÿæˆçš„æœåŠ¡ä»£ç 
â””â”€â”€ docs/                               # è¯¦ç»†æ–‡æ¡£
    â”œâ”€â”€ 01_raw_socket.md               # Socket ç—›ç‚¹åˆ†æž
    â”œâ”€â”€ 02_simple_rpc.md               # RPC åŽŸç†è¯¦è§£
    â”œâ”€â”€ 03_message_broker.md           # Broker å®žçŽ°ä¸Žå¯¹æ¯”
    â””â”€â”€ 04_real_world_examples.md      # gRPC ä¸Ž NATS æ·±å…¥
```

---

## ðŸš€ å¿«é€Ÿå¼€å§‹

### çŽ¯å¢ƒè¦æ±‚

- **Go**: 1.21+
- **å¯é€‰**ï¼šDockerï¼ˆç”¨äºŽè¿è¡Œ NATSï¼‰
- **å¯é€‰**ï¼šprotocï¼ˆç”¨äºŽé‡æ–°ç”Ÿæˆ gRPC ä»£ç ï¼‰

### æž„å»ºé¡¹ç›®

```bash
# å…‹éš†ä»“åº“
git clone https://github.com/cont1nu1ty/distributed-systems-go-demos.git
cd distributed-systems-go-demos

# ä¸‹è½½ä¾èµ–
go mod download

# æž„å»ºæ‰€æœ‰ç¤ºä¾‹
go build ./...
```

---

## ðŸ“– è¿è¡Œç¤ºä¾‹

### ç¤ºä¾‹ 1ï¼šRaw Socketï¼ˆç«¯å£ 9001ï¼‰

```bash
# ç»ˆç«¯ 1ï¼šå¯åŠ¨æœåŠ¡å™¨
cd cmd/01_raw_socket/server
go run main.go

# ç»ˆç«¯ 2ï¼šè¿è¡Œå®¢æˆ·ç«¯
cd cmd/01_raw_socket/client
go run main.go
```

**æŸ¥çœ‹**: [docs/01_raw_socket.md](./docs/01_raw_socket.md)

---

### ç¤ºä¾‹ 2ï¼šSimple RPCï¼ˆç«¯å£ 9100ï¼‰

```bash
# ç»ˆç«¯ 1ï¼šå¯åŠ¨ RPC æœåŠ¡å™¨
cd cmd/02_simple_rpc/server
go run main.go

# ç»ˆç«¯ 2ï¼šè¿è¡Œ RPC å®¢æˆ·ç«¯
cd cmd/02_simple_rpc/client
go run main.go
```

**æŸ¥çœ‹**: [docs/02_simple_rpc.md](./docs/02_simple_rpc.md)

---

### ç¤ºä¾‹ 3ï¼šMessage Brokerï¼ˆç«¯å£ 9200ï¼‰

```bash
# ç»ˆç«¯ 1ï¼šå¯åŠ¨ Broker
cd cmd/03_message_broker/broker
go run main.go

# ç»ˆç«¯ 2ï¼šå¯åŠ¨æ¶ˆè´¹è€… 1
cd cmd/03_message_broker/consumer
go run main.go news 1

# ç»ˆç«¯ 3ï¼šå¯åŠ¨æ¶ˆè´¹è€… 2
go run main.go news 2

# ç»ˆç«¯ 4ï¼šè¿è¡Œç”Ÿäº§è€…
cd cmd/03_message_broker/producer
go run main.go
```

**æŸ¥çœ‹**: [docs/03_message_broker.md](./docs/03_message_broker.md)

---

### ç¤ºä¾‹ 4aï¼šgRPCï¼ˆç«¯å£ 50051ï¼‰

```bash
# ç»ˆç«¯ 1ï¼šå¯åŠ¨ gRPC æœåŠ¡å™¨
cd cmd/04_real_world_examples/grpc_example/server
go run main.go

# ç»ˆç«¯ 2ï¼šè¿è¡Œ gRPC å®¢æˆ·ç«¯
cd cmd/04_real_world_examples/grpc_example/client
go run main.go
```

---

### ç¤ºä¾‹ 4bï¼šNATSï¼ˆç«¯å£ 4222ï¼‰

```bash
# ç»ˆç«¯ 1ï¼šå¯åŠ¨ NATS æœåŠ¡å™¨ï¼ˆéœ€è¦ Dockerï¼‰
docker run -p 4222:4222 nats

# ç»ˆç«¯ 2ï¼šå¯åŠ¨è®¢é˜…è€… 1
cd cmd/04_real_world_examples/nats_example/subscriber
go run main.go news 1

# ç»ˆç«¯ 3ï¼šå¯åŠ¨è®¢é˜…è€… 2
go run main.go news 2

# ç»ˆç«¯ 4ï¼šè¿è¡Œå‘å¸ƒè€…
cd cmd/04_real_world_examples/nats_example/publisher
go run main.go
```

**æŸ¥çœ‹**: [docs/04_real_world_examples.md](./docs/04_real_world_examples.md)

---

## ðŸŽ“ å­¦ä¹ è·¯å¾„

### æŽ¨èé¡ºåº

1. **01_raw_socket**: ç†è§£ä¸ºä»€ä¹ˆéœ€è¦ RPC
2. **02_simple_rpc**: æŽŒæ¡ RPC æ ¸å¿ƒåŽŸç†
3. **04_grpc_example**: å¯¹æ¯”å·¥ä¸šçº§ RPC çš„ä¼˜åŠ¿
4. **03_message_broker**: ç†è§£ Pub/Sub æ¨¡å¼
5. **04_nats_example**: å¯¹æ¯”å·¥ä¸šçº§æ¶ˆæ¯ç³»ç»Ÿ

### æ ¸å¿ƒæ¦‚å¿µå¯¹ç…§è¡¨

| æ¦‚å¿µ | æ•™å­¦å®žçŽ° | å·¥ä¸šå®žçŽ° |
|------|----------|----------|
| **RPC** | Simple RPC (02) | gRPC (04a) |
| **æ¶ˆæ¯ç³»ç»Ÿ** | Broker (03) | NATS (04b) |
| **åºåˆ—åŒ–** | JSON | Protobuf |
| **ä¼ è¾“** | TCP | HTTP/2 |
| **å¹¶å‘** | Goroutine + Channel | å†…ç½®çº¿ç¨‹æ±  |

---

## ðŸ”‘ å…³é”®æŠ€æœ¯ç‚¹

### Go è¯­è¨€ç‰¹æ€§åº”ç”¨

- âœ“ **Goroutine**: æ¯ä¸ªè¿žæŽ¥ã€æ¯ä¸ªè®¢é˜…è€…éƒ½æ˜¯ç‹¬ç«‹ goroutine
- âœ“ **Channel**: Broker ä½¿ç”¨ channel å®žçŽ° Pub/Subï¼ˆé›¶è½®è¯¢ï¼‰
- âœ“ **Interface**: æœåŠ¡å¥‘çº¦å®šä¹‰ï¼ˆ`CalculatorService`ï¼‰
- âœ“ **Reflection**: æœåŠ¡ç«¯åŠ¨æ€æ–¹æ³•è°ƒç”¨ï¼ˆ`reflect.Value.MethodByName`ï¼‰
- âœ“ **Error Handling**: æ‰€æœ‰ç¤ºä¾‹ä¸¥æ ¼éµå¾ª `if err != nil` æ¨¡å¼

### çº¦æŸéµå®ˆ

- âœ“ **æ— è½®è¯¢**: ä½¿ç”¨ channel é˜»å¡žç­‰å¾…ï¼Œä¸ä½¿ç”¨ `for + sleep`
- âœ“ **ä»…æ ‡å‡†åº“**: Simple RPC å’Œ Broker åªä½¿ç”¨ Go æ ‡å‡†åº“
- âœ“ **å¹¶å‘å®‰å…¨**: ä½¿ç”¨ `sync.Mutex` ä¿æŠ¤å…±äº«çŠ¶æ€
- âœ“ **å¯è¿è¡Œ**: æ‰€æœ‰ç¤ºä¾‹å¯ `go run`
- âœ“ **æ”¯æŒå¹¶å‘**: å®¢æˆ·ç«¯å¯å¹¶å‘å‘é€è¯·æ±‚

---

## ðŸ“Š ç«¯å£ä½¿ç”¨çº¦å®š

| æ¨¡å— | ç«¯å£ | åè®® |
|------|------|------|
| Raw Socket | :9001 | TCP |
| Simple RPC | :9100 | TCP + JSON |
| Message Broker | :9200 | TCP + JSON |
| gRPC | :50051 | HTTP/2 + Protobuf |
| NATS | :4222 | NATS Protocol |

---

## ðŸ› ï¸ å¼€å‘å·¥å…·

### é‡æ–°ç”Ÿæˆ gRPC ä»£ç 

```bash
# å®‰è£… protoc æ’ä»¶
go install google.golang.org/protobuf/cmd/protoc-gen-go@latest
go install google.golang.org/grpc/cmd/protoc-gen-go-grpc@latest

# ç”Ÿæˆä»£ç 
protoc --go_out=. --go_opt=paths=source_relative \
       --go-grpc_out=. --go-grpc_opt=paths=source_relative \
       api/proto/calculator.proto
```

---

## ðŸ“ æ€»ç»“

æœ¬é¡¹ç›®é€šè¿‡**å››ä¸ªå±‚æ¬¡**å›žç­”äº†åˆ†å¸ƒå¼ç³»ç»Ÿçš„æ ¸å¿ƒé—®é¢˜ï¼š

1. **é—®é¢˜å®šä¹‰**ï¼ˆ01ï¼‰ï¼šSocket çš„å±€é™æ€§
2. **åŸºç¡€è§£å†³æ–¹æ¡ˆ**ï¼ˆ02ï¼‰ï¼šRPC éšè—ç½‘ç»œå¤æ‚æ€§
3. **å¼‚æ­¥è§£è€¦**ï¼ˆ03ï¼‰ï¼šæ¶ˆæ¯ä¸­é—´ä»¶çš„ Pub/Sub æ¨¡å¼
4. **å·¥ä¸šå®žè·µ**ï¼ˆ04ï¼‰ï¼šgRPC å’Œ NATS çš„ç”Ÿäº§çº§èƒ½åŠ›

### æŠ€æœ¯é€‰åž‹å»ºè®®

```
åŒæ­¥è¯·æ±‚-å“åº”:
  - å¾®æœåŠ¡ API        â†’ gRPC
  - å…¬å¼€ API          â†’ REST
  - å­¦ä¹ ç†è§£          â†’ Simple RPC

å¼‚æ­¥äº‹ä»¶é©±åŠ¨:
  - é«˜åžåé‡          â†’ NATS / Kafka
  - å¤æ‚è·¯ç”±          â†’ NATS
  - æŒä¹…åŒ–å­˜å‚¨        â†’ Kafka
  - å­¦ä¹ ç†è§£          â†’ Broker (Channel)

æ··åˆæž¶æž„:
  - å¾®æœåŠ¡é€šä¿¡        â†’ gRPC (åŒæ­¥) + NATS (å¼‚æ­¥)
  - å®žæ—¶æŽ¨é€          â†’ gRPC (API) + NATS (äº‹ä»¶)
```

---

## ðŸ“š å‚è€ƒèµ„æ–™

- [Go æ ‡å‡†é¡¹ç›®å¸ƒå±€](https://github.com/golang-standards/project-layout)
- [gRPC å®˜æ–¹æ–‡æ¡£](https://grpc.io/docs/languages/go/)
- [NATS å®˜æ–¹æ–‡æ¡£](https://docs.nats.io/)
- [Protocol Buffers](https://protobuf.dev/)

---

## ðŸ“„ è®¸å¯è¯

MIT License - è¯¦è§ LICENSE æ–‡ä»¶

---

## ðŸ‘¥ è´¡çŒ®

æ¬¢è¿Žæäº¤ Issue å’Œ Pull Requestï¼

---

**ä½œè€…**: èµ„æ·± Go è¯­è¨€åˆ†å¸ƒå¼ç³»ç»Ÿæž¶æž„å¸ˆ  
**ç”¨é€”**: æ•™å­¦ã€æŠ€æœ¯æŠ¥å‘Šã€å›¢é˜ŸåŸ¹è®­
